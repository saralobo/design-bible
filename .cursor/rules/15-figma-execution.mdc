---
alwaysApply: true
---

# Regras de Execução no Figma — Como Construir Corretamente

> Este documento contém regras TÉCNICAS específicas para construção de telas no Figma
> usando a API do Figma via MCP. Erros comuns e suas correções.

---

## ANTES DE CRIAR QUALQUER COISA

### 1. Verificar/Criar Container
```javascript
// SEMPRE verifique se existe uma Section ou Frame
let section = figma.currentPage.findOne(n => n.type === 'SECTION');
if (!section) {
  section = figma.createSection();
  section.name = 'Design Components';
}
// Crie seus elementos DENTRO da section
```

### 2. Usar figma.getNodeByIdAsync (NÃO getNodeById)
```javascript
// ❌ ERRADO (com documentAccess: dynamic-page)
const node = figma.getNodeById('123:456');

// ✅ CORRETO
const node = await figma.getNodeByIdAsync('123:456');
```

### 3. Usar setReactionsAsync (NÃO set_reactions)
```javascript
// ❌ ERRADO
node.reactions = [...];

// ✅ CORRETO
await node.setReactionsAsync([...]);
```

---

## AUTO-LAYOUT — ORDEM DE OPERAÇÕES

### REGRA CRÍTICA:
> Adicione o elemento ao parent auto-layout ANTES de setar `layoutSizingHorizontal = 'FILL'`.
> `FILL` só funciona em filhos diretos de auto-layout frames.

```javascript
// ✅ CORRETO — Ordem correta
const parent = figma.createFrame();
parent.layoutMode = 'VERTICAL';
parent.resize(393, 852);

const child = figma.createFrame();
parent.appendChild(child);              // 1. Adicionar ao parent PRIMEIRO
child.layoutSizingHorizontal = 'FILL';  // 2. Depois setar FILL
child.layoutSizingVertical = 'HUG';

// ❌ ERRADO — Vai dar erro
const child2 = figma.createFrame();
child2.layoutSizingHorizontal = 'FILL'; // ERRO: não está em auto-layout parent
parent.appendChild(child2);
```

---

## BOTÃO CIRCULAR — IMPLEMENTAÇÃO CORRETA

```javascript
// ✅ CORRETO — Botão perfeitamente circular
const btn = figma.createFrame();
const SIZE = 56;  // ou 44, 48, etc.
btn.resize(SIZE, SIZE);
btn.cornerRadius = SIZE / 2;  // METADE EXATA

// Auto-layout para centralizar ícone
btn.layoutMode = 'HORIZONTAL';
btn.primaryAxisAlignItems = 'CENTER';
btn.counterAxisAlignItems = 'CENTER';

// CRÍTICO: FIXED em AMBOS os eixos
btn.primaryAxisSizingMode = 'FIXED';
btn.counterAxisSizingMode = 'FIXED';

// NÃO FAÇA:
// btn.primaryAxisSizingMode = 'AUTO';  ← Vai alongar com conteúdo!
// btn.layoutSizingHorizontal = 'HUG'; ← Mesmo problema!
```

### Regra: Para QUALQUER elemento que deve ser circular
1. `width` DEVE ser IGUAL a `height`
2. `cornerRadius` = `width / 2`
3. Sizing mode = `FIXED` em ambos os eixos
4. NUNCA usar HUG ou AUTO que pode distorcer

---

## CORES — FORMATO CORRETO

```javascript
// No Figma API, cores são RGB normalizado (0-1), NÃO hex

// ✅ CORRETO — Converter hex para RGB normalizado
function hexToFigmaRGB(hex) {
  hex = hex.replace('#', '');
  return {
    r: parseInt(hex.substring(0, 2), 16) / 255,
    g: parseInt(hex.substring(2, 4), 16) / 255,
    b: parseInt(hex.substring(4, 6), 16) / 255
  };
}

// Aplicar fill
frame.fills = [{
  type: 'SOLID',
  color: hexToFigmaRGB('#276EF1')
}];

// ❌ ERRADO — hex direto não funciona
frame.fills = [{ type: 'SOLID', color: '#276EF1' }];
```

---

## TEXTO — CARREGAR FONTE ANTES

```javascript
// ✅ CORRETO — Carregar fonte ANTES de criar/modificar texto
await figma.loadFontAsync({ family: 'Inter', style: 'Regular' });
await figma.loadFontAsync({ family: 'Inter', style: 'Semi Bold' });
await figma.loadFontAsync({ family: 'Inter', style: 'Bold' });

const text = figma.createText();
text.fontName = { family: 'Inter', style: 'Semi Bold' };
text.characters = 'Hello World';
text.fontSize = 16;

// ❌ ERRADO — Sem carregar a fonte
const text2 = figma.createText();
text2.characters = 'Vai dar erro';  // ERRO: fonte não carregada
```

---

## PROTOTYPING — FORMATO CORRETO DE REACTIONS

```javascript
// ✅ CORRETO — Formato completo de reactions
await sourceNode.setReactionsAsync([{
  trigger: { type: 'ON_CLICK' },
  actions: [{                          // PLURAL: actions (não action)
    type: 'NODE',
    destinationId: targetNode.id,
    navigation: 'NAVIGATE',
    transition: {
      type: 'SLIDE_IN',               // ou SLIDE_OUT, DISSOLVE, SMART_ANIMATE
      direction: 'LEFT',              // LEFT, RIGHT, TOP, BOTTOM
      matchLayers: false,
      duration: 0.35,                 // em SEGUNDOS (não ms!)
      easing: { type: 'GENTLE' }     // ou EASE_IN_AND_OUT, EASE_OUT, etc.
    },
    preserveScrollPosition: false
  }]
}]);

// ❌ ERRADO — action singular
await node.setReactionsAsync([{
  trigger: { type: 'ON_CLICK' },
  action: { ... }  // ERRADO: use actions (plural)
}]);
```

---

## OVERFLOW E SCROLL

```javascript
// ✅ CORRETO — Scroll horizontal
frame.overflowDirection = 'HORIZONTAL';  // Enum correto
frame.clipsContent = true;

// Para que funcione, o conteúdo interno deve ser MAIS LARGO que o frame
// Use primaryAxisSizingMode = 'AUTO' para que o conteúdo interno expanda

// ❌ ERRADO
frame.overflowDirection = 'HORIZONTAL_SCROLLING';  // Enum inválido!
```

### Valores válidos para overflowDirection:
- `'NONE'` — sem scroll
- `'HORIZONTAL'` — scroll horizontal
- `'VERTICAL'` — scroll vertical
- `'BOTH'` — scroll em ambas direções

---

## FLOW STARTING POINTS

```javascript
// ✅ CORRETO — Definir ponto inicial do flow
figma.currentPage.flowStartingPoints = [{
  nodeId: startFrame.id,
  name: 'Nome do Flow'
}];

// ❌ ERRADO — Setar no node diretamente
startFrame.flowStartingPoints = [...];  // Não funciona
```

---

## COMPONENTES E VARIANTES

```javascript
// Criar componente
const component = figma.createComponent();

// Criar component set (variantes)
const variant1 = figma.createComponent();
variant1.name = 'State=Default';

const variant2 = figma.createComponent();
variant2.name = 'State=Hover';

// Combinar em set
const componentSet = figma.combineAsVariants([variant1, variant2], figma.currentPage);
componentSet.name = 'Button';
```

---

## CHECKLIST PRÉ-EXECUÇÃO

Antes de executar código no Figma:

- [ ] Container/Section existe ou será criado?
- [ ] Fontes serão carregadas com `loadFontAsync` ANTES de usar?
- [ ] Cores estão em formato RGB normalizado (0-1), não hex?
- [ ] Auto-layout parent existe ANTES de setar FILL nos filhos?
- [ ] Botões circulares têm FIXED size em ambos os eixos?
- [ ] Prototyping usa `actions` (plural) e `setReactionsAsync`?
- [ ] Durations em reactions são em SEGUNDOS (0.35), não ms (350)?
- [ ] `getNodeByIdAsync` (não `getNodeById`)?
- [ ] `overflowDirection` usa enum correto ('HORIZONTAL', não 'HORIZONTAL_SCROLLING')?

---

## NAMING CONVENTION

### Layers no Figma:
```
Screen/HomePage                    ← Tela principal
├── Section/Header                 ← Seção
│   ├── Row/TopBar                 ← Row horizontal
│   │   ├── Icon/Back              ← Ícone
│   │   ├── Text/ScreenTitle       ← Texto
│   │   └── Icon/Settings          ← Ícone
│   └── Row/BalanceCard            ← Card
├── Section/Content                ← Seção
│   ├── Text/SectionTitle          ← Título de seção
│   ├── Card/Transaction           ← Card individual
│   └── Card/Transaction           ← Card individual
└── Section/BottomNav              ← Navegação
    ├── NavItem/Home               ← Item de nav
    ├── NavItem/Search             ← Item de nav
    └── NavItem/Profile            ← Item de nav
```

### Regra: Prefixo indica o tipo:
| Prefixo | Tipo |
|---|---|
| Screen/ | Frame de tela completa |
| Section/ | Seção da tela |
| Row/ | Layout horizontal |
| Card/ | Card container |
| Text/ | Nó de texto |
| Icon/ | Ícone |
| Button/ | Botão |
| Input/ | Campo de entrada |
| NavItem/ | Item de navegação |
| Badge/ | Badge/indicador |
| Avatar/ | Avatar/foto |
| Divider/ | Linha separadora |

---

## TAMANHOS PADRÃO PARA REFERENCIAR

| Elemento | Width | Height |
|---|---|---|
| Tela mobile | 393px | 852px |
| Header | Fill | 56px |
| Bottom nav | Fill | 56px + safe area |
| Botão large | Fill | 48-56px |
| Botão medium | Hug | 44px |
| Input | Fill | 48-56px |
| Card | Fill | Hug |
| Avatar small | 32px | 32px |
| Avatar medium | 40px | 40px |
| Avatar large | 48px | 48px |
| Icon | 24px | 24px |
| Icon small | 20px | 20px |
| Icon large | 32px | 32px |
| FAB | 56px | 56px |
| Badge | auto | 20px |
| Divider | Fill | 1px |
